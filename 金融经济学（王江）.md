# 金融经济学笔记（王江）


作者：[田天宇](https://econ.cufe.edu.cn/info/1287/7810.htm)

下载最新版本:
Github（需要翻墙）:https://github.com/Tianyu-Tian/FinancialEconomicsNotes
码云（无需翻墙）：https://gitee.com/tian_tianyu/FinancialEconomicsNotes


<!--- 
极简笔记版本：https://blog.csdn.net/weixin_51499396/category_10686302.html
--->


**目录**
[TOC]

---

## 第1章 引论

（略）

## 第2章 基本框架

### 经济环境

状态 $\omega$：未来每一可能性

状态空间 $\Omega$：可能状态的集合

概率测度 $P$：$P \equiv \{p_\omega, \omega \in \Omega\}$，$p_\omega$是$\omega$发生概率，且$\sum_{\omega=1}^\Omega p_\omega = 1$

![](./插图/图2.0.png)

### 经济参与者

假设共有$K$个参与者，并用指标$k$进行表示（$k=1,2,...,K$）

一个参与者的**经济特征**包括：参与者的经济资源；参与者的经济需求

1.参与者的经济资源：

禀赋：参与者初始占有的资源，在本文定义为在每一时期和未来每一可能状态下拥有的商品

比方说参与者$k$，记他在0期的禀赋为$e_{k,0}$，在1期$w$状态下的禀赋为$e_{k,1\omega}$，那么他的禀赋可以表示为:

$$
e_{k} \equiv [e_{k,0};e_{k,1}]=[e_{k,0};[e_{k,11};\cdots;e_{k,1\omega},\cdots,e_{k,1\Omega}]]
$$

在数学上，每一个参与者的禀赋可以看成$(1+\Omega)$维实空间$R^{1+\Omega}$中的一个元素。若进一步假设禀赋是非负的，那么 $e_k \in R^{1+\Omega}_+$ （等价于$e \geq 0$）,其中 $R^{1+\Omega}_+$是 $R^{1+\Omega}$的正象限

![](./插图/图2.1.png)
上图是当 $\Omega = 2$时禀赋作为 $R^{1+\Omega}_+$的一个元素的例子


2.参与者的经济需求：


对于参与者$k$，记他在0期的消费为$c_{k,0}$，在1期$\omega$状态下的消费为$c_{k,1\omega}$，其中$ \omega \in \Omega$，那么他的消费可以表示为:

$$
c_{k} \equiv [c_{k,0};c_{k,1}]=[c_{k,0};[c_{k,11};\cdots;c_{k,1\omega},\cdots,c_{k,1\Omega}]]
$$

第0期的消费是在0期决定的，不依赖1期的状态，因此与$\omega$无关

（1）消费集

消费计划：参与者的可能消费选择$c = [c_0;c_1]$，依赖经济的未来状态

消费路径：消费计划的一个特定实现值，比如 $(e_0,e_{1\omega})$

消费集 $C$：所有可能消费计划的集合。与禀赋一样，消费集就是$C =  R^{1+\Omega}_+$


定义2.1$\quad$设$A$为$R^n$的一个集合，对于任意的$a,b \in A$和$\alpha \in [0,1]$，$\alpha a + (1-\alpha)b$也在$A$中，则称集合A为凸的

定义2.2$\quad$对于$R^n$的集合$A$，如果有任意序列$a_i(i =1,2,...)$有极限$\alpha$，且$\alpha$也在A内，则称集合A是闭的

假设1$\quad$消费集$C =  R^{1+\Omega}_+$是$R^{1+\Omega}$的一个闭凸子集


>通俗地说，凸集就像内部没有“洞”或“凹陷”的实心物体，而闭集则像是包含了完整边界的容器，严丝合缝，没有“缺口”。
举例说明：
满月🌕是凸集，月牙🌙是非凸
[0,1]是闭集，(0,1)是开集



<!-- 
通俗地说，凸集就像内部没有“洞”或“凹陷”的实心物体，而闭集则像是包含了完整边界的容器，严丝合缝，没有“缺口”。

举例说明：
满月🌕是凸集，月牙🌙是非凸
[0,1]是闭集，(0,1)是开集

-->


（2）偏好

偏好：参与者对所有可能消费计划的一个排序，正式定义如下

定义2.3$\quad$偏好是C上的一个二元关系，表示为$\succsim$，满足以下条件：
·完备性：$\forall a,b \in C, a \succsim b $ 或 $b \succsim a$，或两者都成立（称a与b等价，$a \backsim b$）
·传递性：$a \succsim b$且$b \succsim c$，则$a \succsim c$


（3）偏好的基本假设

公理1$\quad$不满足性：如果$a > b$，那么$a \succ b$


> $\succsim$是弱偏好，代表“至少一样好”；$\succ$代表	“严格优于”



公理2$\quad$连续性：$\forall c \in C$，集合$ \{ a \in C: a \succsim c \}$和$\{ b \in C: b \precsim c \}$是闭的

>集合a没有间断或是“缺口”的地方

公理3$\quad$凸性：$\forall a,b \in C$以及$ \alpha \in (0,1)$，如果$a \succ b$，则 $\alpha a + (1-\alpha)b \succ b$

>推导：移项


（4）效用函数

效用：给每个消费计划赋予一个实数

效用函数：从消费计划到实数的映射

定义2.4$\quad$对应于偏好关系的效用函数$U$是从$C$到$R$的函数，$U:C \to R$，使得 $\forall a,b \in C$，当且仅当$a \succsim b$时$U(a) \ge U(b)$ 

定理2.1$\quad$（Debreu）对于一个在闭的、凸消费集C上由定义2.3所定义的、满足公理2的偏好，存在以一个定义于C上的连续效用函数U(·)使得

$$
\forall a,b \in C, a \succsim b, 当且仅当U(a) \ge U(b)
$$



>书p16，看一看例2.3


基于效用函数的三个偏好基本假设：
1.不满足性：若$a \ge b$，那么$U(a) \ge U(b)$
2.连续性：$ \lim_{a_{n} \to a} U(a_n) = U(a)$
3.凸性：如果$U(a) > U(b)$且$\alpha \in (0,1)$，那么$U(\alpha a+(1-\alpha)b) > U(b)$


### 证券市场

假设金融市场由一组证券构成。令$x_\omega$为证券在状态$w$时候的支付，其中$\omega \in \Omega$，那么一个证券就可以由它在各个可能状态下的支付$\{ x_\omega, \omega=1,2,...,\Omega \}$来定义

>支付矩阵通过表格形式，定义了所有市场情境下各种决策的后果。可以理解为是表明了不同情况的收益矩阵

定义$R^\Omega$为支付空间，即所有可能支付的集合，支付空间的一个向量$x = [x_1;...;x_\Omega]$也就定义了一只证券

假设市场有N只可交易的证券，标号为$n(n = 1,2,...,N)$,则市场的中所有交易证券的支付(也称市场结构)为：
$$
X \equiv [X_{.,1},X_{.,2},...,X_{.,N}] \equiv \begin{bmatrix}
X_{1,1}&\cdots&X_{1,n}&\cdots&X_{1,N}\\
\vdots&\ddots&\vdots&\ddots&\vdots\\
X_{\omega,1}&\cdots&X_{\omega,n}&\cdots&X_{\omega,N}\\
\vdots&\ddots&\vdots&\ddots&\vdots\\
X_{\Omega,1}&\cdots&X_{\Omega,n}&\cdots&X_{\Omega,N}\\
\end{bmatrix}
$$

>每一行是相同的一个状态，每一列代表一只证券，举例：
$$
\begin{bmatrix}
 &半导体ETF&创新药ETF\\
纳斯达克涨&+30\%&-10\%\\
纳斯达克跌&-20\%&+20\%\\
\end{bmatrix}
$$

证券组合：一个对各证券持有量的集合。设一个组合对证券$n$的持有量为$\theta_n(n=1,...,N)$，则我们用持有向量$\theta \equiv [\theta_1;...;\theta_n]$来定义这个组合

假设每一个参与者k，在开始的时候持有$\bar\theta_{k,n}$份证券$n(n = 1,...,N;k=1,...K)$，则$\bar\theta_{k} \equiv [\bar\theta_{k,1};...;\bar\theta_{k,N}]$代表参与者k的初始证券组合

如果将所有参与者的初始证券组合求和，得到了市场中所有可交易证券的集合，称为市场组合：
$$
\theta_m = \sum_{k=1}^K \bar\theta_k
$$

任何一个支付 $x$，如果它可以由交易组合来复制或者产生，即存在 $\theta$，使得 $X\theta = x$，则我们称它为**市场化的**，即可以通过交易由市场取得

>$X$是收益矩阵，$\theta$是你有的个股数量，$x$是最终回报

我们记所有市场化支付的集合为M，有 $M \equiv \{ X\theta:\theta \in R^N \}$


记 $S \equiv [S_1;S_2;...S_N]$为交易证券的价格列向量，令 $\theta_k(S) \equiv [\theta_{k,1}(S);...;\theta_{k,N}(S)]$表示参与者k在价格S下对证券的需求向量

交易系统找到一个价格向量S使得所有证券的总需求等于这些向量的总供给：
$$
\sum_{k=1}^K \theta_k(S) = \sum_{k=1}^K \bar\theta_k
$$

接着公布市场出清价格

本文假设没有市场摩擦（市场摩擦假设见书p22）


### 基本经济模型


定义2.5$\quad$一个经济的定义如下：
1.有两个时期，0和1，在1期有$\Omega$个可能状态，有概率测度P
2.经济中有K个参与者(k=1,...,K):
    （a）同一参与者对未来状态发生的可能性都有相同信息，用P描述
    （b）每一参与者都有禀赋 $e_k \in R^{1+\Omega}_+$
    （c）每一参与者有定义于 $C = R_+^{1+\Omega}$上，且满足公理1到公理3的偏好
3.有一个市场结构为X的无摩擦证券市场

定义2.6$\quad$在上述定义的经济中，如果所有参与者的1期禀赋都可以表示为其初始证券组合的支付，则我们称之为证券市场经济

### 市场均衡

消费者在0期购买组合 $\theta$，则他在0期的消费为 $c_0=e_0-S^T\theta$

>S是证券价格矩阵，$\theta$代表消费者要买多少的证券。购买组合$\theta$所用的成本代表了参与者0期的储蓄

在1期的消费为 $c_1=e_1+X\theta$

消费者可选的消费计划集（也叫预算集）为：

$$
B(e,\{ X,s\})=\{c\geq0:c_0=e_0-S^T\theta, c_1=e_1+X\theta,\theta \in R^N \}
$$

消费者选择让他效用最高的消费集，优化问题即：

$$
\begin{align*}
\underset{\theta_k}{\max} \quad & U_k(c_k) \\
\text{s.t.} \quad & c_{k,0}=e_{k,0}-S^T\theta_k \\
& c_{k,1}=e_{k,1}+X\theta_k \\
& c_0,c_1 \geq 0 \\
\end{align*}
$$

显然需求量是价格向量和禀赋的函数，记 $\theta_k(e_k,S)$

本文假设没有新发行的证券，所有证券都源于各个消费者之间的交换（也可看成实物交换），因而市场出清条件为 $\sum_{k=1}^K \theta_k(e_k,S)=0$，这决定了证券交易的均衡价格

>相当于零和博弈

因为 $c_{k,0}=e_{k,0}-S^T\theta_k$，因此
$$
\sum_{k=1}^Kc_{k,0}=\sum_{k=1}^Ke_{k,0}-S^T\sum_{k=1}^K \theta_k(e_k,S)=\sum_{k=1}^Ke_{k,0}
$$

在不同的状态$\omega$下，该定理仍符合，即

$$
\sum_{k=1}^Kc_{k,\omega}=\sum_{k=1}^Ke_{k,\omega},\omega=1,...,\Omega
$$

Walrus法则：证券市场的出清也代表商品市场的出清：
$$
\sum_{k=1}^Kc_k=\sum_{k=1}^Ke_k
$$


**因此，求均衡解包括两个步骤：首先，对任意价格向量S求解每个参与者的最优证券组合，得到需求量$\theta_k(e_k,S)$；其次，通过市场出清条件得到均衡价格S**



### 最优性

前面求的是基于个人的最优解，但对于社会而言不一定是最优解

这里引入一个特定评判标准，记$\{c_k,k=1,...,K\}$为经济中的一个配置

定义2.7$\quad$配置$\{c_k,\forall k \}$，Pareto占优配置$\{c_k',\forall k \}$，如果 $\forall k:U_k(c_k') \geq U_k(c_k)$且严格不等式至少对一个参与者成立

>帕累托改进，没有人变坏，至少有一个人变好

定义2.8$\quad$给定经济的总供给$\{e_k,\forall k \}$，一个配置$\{c_k,\forall k \}$是可行的，如果 $\sum_k c_k=\sum_k e_k$

>可配置的资源等于经济的总资源，相当于各资源在使用上没有限制


定义2.9$\quad$帕累托最优(Pareto Opimality)：配置$\{c_k,\forall k \}$是可行的且没有另外占优的可行配置

>教材p28,例2.5：帕累托最优没有考虑不同参与者相对于不同参与者的福利

帕累托最优配置也叫有效配置，达到帕累托最优配置的市场叫有效市场







---



## 第3章 Arrow-Debreu经济

### Arrow-Debreu证券市场

定义3.1$\quad$状态$\omega$或有要求权就是当状态为$\omega$时支付为1而其他状态下支付为0的证券。也可写为$x(\omega')=1_\omega(\omega')$，其中$1_\omega(·)$是示性函数，当$\omega'=\omega$时取值为1

对于每个证券，我们可以定义相应的状态或有要求权，总的来看共有$\Omega$个状态或有要求权，这些状态或有要求权/状态或有证券也叫Arrow-Debreu证券

在这个市场中，不同的证券个数等于可能的状态数，即 $N=\Omega$，其支付矩阵/市场结构为：
$$
X^{A-D} \equiv \begin{bmatrix}
1 &\cdots& 0 &\cdots& 0 \\
\vdots&\ddots&\vdots&\ddots&\vdots\\
0 &\cdots& 1 &\cdots& 0 \\
\vdots&\ddots&\vdots&\ddots&\vdots\\
0 &\cdots& 0 &\cdots& 1 \\
\end{bmatrix} =  I
$$

### 状态价格

记$\phi_\omega$为状态$\omega$或有证券在0期的价格，也叫状态$\omega$的状态价格

状态价格向量记为$\phi \equiv [\phi_1 ; \cdots;\phi_\omega;\cdots;\phi_\Omega]$

证券的状态价格必须为正（没有免费的午餐）：$\phi \gg 0$

### 市场的完全性


Arrow-Debreu证券的一个重要性质是为未来融资。设1期的消费计划为$x = [c_{11};\cdots;c_{1\omega};\cdots;c_{1\Omega}]$，考虑如下1期的证券组合：$\theta = [c_{11};\cdots;c_{1\omega};\cdots;c_{1\Omega}]$，使得在1期的支付正好等于消费计划：
$$
X\theta = X^{A-D}[c_{11};\cdots;c_{1\omega};\cdots;c_{1\Omega}] = x
$$

这个支付的成本是:
$$
\phi^T\theta = \sum_{\omega \in \Omega}\phi_\omega c_{1\omega}
$$

定义3.2$\quad$如果市场的任一有限消费计划都可以通过有限成本的可交易证券来融资，那么称这个证券市场是完全的


### 参与者的优化

考虑一个参与者，其禀赋为 $e$，效用函数为 $U$。给定市场中交易的状态或有证券，我们可以认定参与者的1期禀赋就是他对这些证券的初始持有量

>例如，在 $\omega$的情况下，参与者在1期获得的或有证券为 $e_{1\omega}$，其他证券都是0

下面组合 $\bar\theta=[e_{11};\cdots;e_{1\omega};\cdots;e_{1\Omega}]$所带来的支付与参与者在1期的禀赋完全一样:
$$
X^{A-D}\bar\theta = \bar\theta=e_1=\begin{bmatrix}
e_{11}\\
\vdots \\
e_{1\Omega}\\
\end{bmatrix}
$$

> $\bar\theta$也称复制组合，它的支付复制了一个给定的支付（参与者在1期的禀赋）


参与者的金融财富（或简单称为“财富”）：
$$
\omega = e_0 + \phi^Te_1
$$

>参与者初始有的证券加上在1期能保留下来的或有证券

预算约束（现在和将来消费的总成本不能超过总财富）：
$$
c_0 + \phi^Tc_1 = \omega = e_0 + \phi^Te_1
$$

>$\phi$是或有证券的价格，取$\omega = 1$时的状态举例，等式为 $c_0+\phi_1 c_1 = e_0 + \phi_1 e_1$


为表达简单，定义价格向量 $\hat\phi = [1;\phi]$，规定1单位0期消费的价格为1，则预算约束变为 $\hat\phi^Tc = \hat\phi^Te $

优化问题变为:
$$
\max_{c \in C}\quad U(c) \\
\text{s.t.} \quad \hat\phi^Tc = \hat\phi^Te \\
\quad c\geq 0
$$

定理3.1$\quad$令消费集$C \in R_{+}^{1+\Omega}$且$U(·)$在$C$上连续，则上面的优化问题有解

>证明见书p37。提示：定义在 $R^{1+\Omega}$上的连续函数$U(c)$有界闭集上可以取到最大值（Weierstrass定理）

假设参与者的效用函数可微，那么有不满足公理有：
$$
\partial_0 D > 0,\quad \partial_\omega U > 0,\quad \forall \omega \in \Omega
$$

其中，$\partial_0 D$代表 $U$对0期消费 $c_0$的偏导数/边际效用，$\partial_\omega U$代表对1期在状态 $\omega$下消费 $c_{1\omega}$的偏导数/边际效用。向量形式可写为:
$$
DU \equiv \begin{bmatrix}
    \partial_0 D \\
    \partial_1 D \\
    \vdots\\
    \partial_\Omega D\\
\end{bmatrix} \gg 0
$$


定理3.2$\quad$（库恩塔克条件）假定$DU \gg 0$，那么优化问题的解满足：
$$
\partial_i D = \lambda\phi_i + \mu_i,\quad i = 0,1,\cdots,\Omega \\
\hat\phi^T(e-c) = 0\\
\mu_ic_i = 0,\quad i = 0,1,\cdots,\Omega\\
$$
这里 $\lambda > 0,\mu > 0,\quad i = 0,1,\cdots,\Omega$

>例题
![](./插图/例3.3(1).png)
![](./插图/例3.3(2).png)


内部解：达到最优时非负性约束不起作用
边角解：非负性约束起作用

后续不做声明的情况下都假设解为内部解

假设存在内部解，可以把一阶条件写为 $DU_k(c_k)=\lambda_k\hat\phi$，则有 $\partial_0U_k(c_k)=\lambda_k\phi_0=\lambda_k; \quad \partial_\omega U_k(c_k)=\lambda_k\phi_\omega$，即:
$$
\frac{\partial_\omega U_k(c_k)}{\partial_0U_k(c_k)}=\phi_\omega
$$

拓展到多人：
$$
\frac{\partial_\omega U_k(c_k)}{\partial_0U_k(c_k)}=\phi_\omega=\frac{\partial_\omega U_k'(c_k')}{\partial_0U_k'(c_k')}
$$

>前文提到假设0期消费的价格 $\phi_0$为1
上式描述了达到最优时，在1期状态 $\omega$下消费的边际效用与0期消费的边际效用之比等于 $\omega$的状态价格
类比中微里的 $\frac{U'_a}{U'_b}=\frac{P_a}{P_b}$ ，只不过这里 $P_b=1$



### 市场均衡

定理3.3$\quad$对于定义2.5中给出的，存在Arror-Debreu证券市场的经济来说，均衡总是存在的

Arror-Debreu经济均衡是指以下条件成立的价格集合：
1.给定状态价格，每一参与者达到最优化:
$$
c_k(e_k,\phi) = Argmax \quad U_k(c_k)\\
s.t.\quad (1)c_{k,0} +\phi^Tc_{k,1} = e_{k,0} +\phi^Te_{k,1}\\
\quad (2) c_k \geq 0
$$
2.证券市场出清:
$$
\sum_{k} c_{k,0}(e_k,\phi) = \sum_k e_{k,0}\\
\sum_{k} c_{k,1}(e_k,\phi) = \sum_k e_{k,1}
$$

>例题
![](./插图/例3.4(1).png)
![](./插图/例3.4(2).png)

定理3.4$\quad$对于定义2.5中给出的，存在Arror-Debreu证券市场的经济来说，均衡达到的资源配置是Pareto最优的

>证明见课本p44。
本定理也称为“福利经济学第一定理”，指完全的、无摩擦的市场能达到帕累托最优

---

## 第4章 套利和资产定价

### 一般市场结构

复合证券：在多个状态下有多个不同的支付

证券 $n$的支付向量: $X_{.,n}=[x_{1,n};\cdots;x_{\omega,n};\cdots;x_{\Omega,n}]$

市场结构（支付矩阵）：
$$
X = \begin{bmatrix}
    x_{1,1} & \cdots & x_{1,n} & \cdots & x_{1,N}\\
    \vdots & \ddots & \vdots & \ddots & \vdots \\
    x_{\omega,1} & \cdots & x_{\omega,n} & \cdots & x_{\omega,N} \\
    \vdots & \ddots & \vdots & \ddots & \vdots \\
    x_{\Omega,1} & \cdots & x_{\Omega,n} & \cdots & x_{\Omega,N} \\
\end{bmatrix}
$$


冗余证券：一个证券的支付可以由其他证券的组合得到

在无摩擦的市场中，有冗余证券和无冗余证券都是等价的市场结构，一般会忽略冗余证券

由于不存在冗余证券，因此市场结构 $X$ 是满秩的，且 $rank(X)=min\{N,\Omega\}=N$

给定具有线性独立支付矩阵 $X$ 的证券集合，我们可以形成 $N$ 个线性独立组合，记为 $\theta_1,\cdots,\theta_N$ ，他们的支付矩阵是:
$$
X_\theta \equiv \begin{bmatrix}
    x_{1,\theta_1} & \cdots & x_{1,\theta_N} \\
    \vdots & \ddots & \vdots \\
    x_{\Omega,\theta_1} & \cdots & x_{\Omega,\theta_N}  \\
\end{bmatrix} = X[\theta_1,\cdots,\theta_N]
$$

>每个 $\theta$ 都是之前N个证券的线性组合向量

令 $H=[\theta_1,\cdots,\theta_N]$，则 $H$ 是$N*N$ 矩阵。易知 $X_\theta$ 也是可逆，因此有 $X = X_\theta H^{-1}$，相当于等号右边复制了原始市场结构

如果不存在摩擦，独立组合 $\theta_1,\cdots,\theta_N$ 提供了市场结构的一个等价描述



### 套利


资产定价关系：支付矩阵X到交易证券的价格向量S的关系

考虑一个交易证券的组合 $\theta = [\theta_1,\cdots,\theta_N]$，它在0期的价值为 $S^T\theta$，在1期的支付向量为 $X\theta$。其中，负的 $\theta_n$代表对证券进行做空，证券可能在未来某状态带来负的支付（也叫责任）。我们称未来支付非负，即$X\theta \geq 0$，也叫有限责任

定义4.1$\quad$将满足下面条件的组合$\theta$称为套利或者套利机会：
(1)$S^T\theta \leq 0$
(2)$X\theta \geq 0$
(3)至少有一个不等式严格成立

按照上面定义的套利，可以分为三种类型：
（1）第1类套利：$S^T\theta < 0$且$X\theta = 0$
（2）第2类套利：$S^T\theta = 0$且$X\theta > 0$
（3）第3类套利：$S^T\theta < 0$且$X\theta > 0$




### 无套利原理


定理4.2$\quad$在市场均衡中不存在套利机会

定义4.2$\quad$无套利原则：证券市场中不存在套利机会


### 资产定价基本定理


资产定价关系的形式可以写为 $S = V(x)$，其中 $V(·)$常称为定价算子或估价算子

定理4.3$\quad$一价定律：两个具有相同支付的证券（或者组合）的价格必定相等，即：若$x=y$，则$V(x)=V(y)$。推论： $V(0)=0$

定理4.4$\quad$支付为正的证券或组合的价格为正，即:若 $x>0$，则 $V(x)>0$

定理4.5$\quad$给定两只证券1和2，如果证券1的支付总是大于证券2的，那么证券1的价格必定高于证券2，即：若$x_1 \geq x_2$，则 $V(x_1) \geq V(x_2)$

定理4.6$\quad$在一个无摩擦市场中，定价算子是递增的线性算子。即：$\forall x,b \in R, V(ax+by)=aV(x)+bV(y)$，则资产定价算子可以表达为$V(x)=\phi^Tx$，其中$\phi$是正向量

定理4.7$\quad$资产定价基本定理：证券市场中不存在套利机会的充要条件是 $\exists \phi \gg 0$ 使得 $S = (\phi^TX)^T$

引理4.1$\quad$Stiemke引理：令 $X$ 为一个 $m \times n$的矩阵， $m$ 和 $n$ 是任意正整数，$\theta, \phi, S \in R^n$当且仅当 $\exists \phi \gg 0$ 且 $S = (\phi^T X)^T$时，集合 $\{\theta:[-S^T\theta;X\theta]>0\}$是空集

> $-S^T\theta = -(\phi^T X)^T \theta = -X^T\phi\theta>0$，在 $X\theta>0$ 的情况下推得 $\phi<0$，与前文对 $\phi$ 定义不符合，因此空集的时候是无套利的

定理4.8$\quad$在一个完全证券市场中，状态价格向量是唯一的



### 风险中性定价和鞅


定义一个无风险债券，在1期的确定支付是1，即支付向量 $x_1=[1;1;\cdots;1]=\iota$，价格为 $S_1 = \phi^T\iota = \sum_{\omega \in \Omega} \phi_\omega$

定义1单位无风险证券投资的净支付或收益率也称作无风险利率，记为 $r_F$，则

$$
S_1(1+r_F) = 1
$$

我们可以重新将债券的定价公式写为 $S_1 = \frac{1}{1+r_F}$，即折现。 $r_F$看作折现率

更一般的，支付为 $x_n = [x_{1,n};\cdots;x_{\Omega,n}]$的证券n，有 $S_n=\phi^T x_n = \sum_{\omega \in \Omega} \phi_\omega x_{\omega,n}$

定义 $q_\omega \equiv \frac{\phi_\omega}{\sum_{\omega'} \phi_{\omega'}} $，由于 $\sum_\omega q_\omega = 1$，因此可以将 $Q \equiv \{ q_\omega, \omega \in \Omega \}$看作一个概率测度，即 $S_n = \frac{E^Q[\tilde x_n]}{1+r_F},n = 1,\cdots, N$（风险中性定价）

这里，我们把证券的支付n当做一个随机变量$\tilde x_n$，而 $E^Q[·]$ 代表在概率测度Q下取期望值

> 证券价格就是它在测度Q下的期望支付对无风险利率的折现，Q称为风险中性测试
> 需要注意的是，风险中性定价公式是对新定义的概率测度Q而不是实际概率测度P取期望值

由于无风险债券有 $S_1=\frac{1}{1+r_F}, \tilde x_1 = 1$，因此风险中性定价公式可改写为
$$
\frac{S_n}{S_1} = E^Q[\frac{\tilde x_n}{\tilde x_1}]
$$


一般来说，我们记 $\hat S_{n,t} \equiv \frac{S_{n,t}}{S_1}$为以无风险债券为单位的、证券n在t期的价格，这里t = 0,1，则有 $\hat S_{n,t} = E^Q[\hat S_{n,t+1}]$，这里t = 0

> 由于无套利的限制，未来的相对价格之比的期望应该与当下的相对价格之比相等
> 以无风险债券价格为计量单位，证券价格在风险中性测度Q下是鞅，Q也称等价鞅测度


定义4.3$\quad$如果一个随机过程, $z_1,z_2,\cdots$ 现在的值恒等于对未来值的条件期望 $z_t = E_t[z_{t+1}]$，则我们称之为鞅


---


## 第5章 期权：一个套利定价的例子

### 期权

记一只股票 $t=1$ 期的支付为 $\tilde X$，$t=0$ 期的价格为 $S$。

定义5.1$\quad$欧式看涨European call（看跌put）：期权给予期权购买者在未来某一给定日期、以某一确定价格K从（向）期权出售者处买入（卖出）单位股票的权利

到期日：期权购买者可以执行其权利的日期
K：执行价格

记 $\tilde c$ 为欧式看涨期权 $t=1$ 期的支付，$\tilde p$ 为欧式看跌期权 $t=1$ 期的支付，则有：
$$
\tilde c = [\tilde X - K]_+,\quad \tilde p = [K-\tilde X]_+
$$

这里 $[x]_+ \equiv max[0,x]$

对于欧式期权来说，只有到期日才能执行；如果在到期日前的任意日期也可以执行，叫做美式期权

定义5.2$\quad$执行价为K、到期日为t的美式看涨（看跌）期权赋予期权购买者在到期日前任意一日期（包括到期日）、以某一确定价格K从（向）期权出售者买入（卖出）单位股票的权利


看涨期权内在价值：S-K
看跌期权内在价值：K-S
内在价值大于零、等于零、小于零相应称为实值、平值、虚值

[衍生证券](https://baike.baidu.com/item/%E8%A1%8D%E7%94%9F%E8%AF%81%E5%88%B8/6967893)：1.净供给量为0；2.支付由其他证券的价格或支付来决定



记 $c(S,K)$ 为欧式看涨期权 $t=0$ 期的价格，$p(S,K)$ 为欧式看跌期权 $t=0$ 期的价格；记 $C(S,K),P(S,K)$为相应美式期权的价格



### 期权价格的性质和界

先从欧式期权开始：

定理5.1$\quad$ $c(S,K)，p(S,K)$是非负的
>无套利定理中的第一条，现价非负

定理5.2$\quad$ $c(S,K)$ 对K非增，$p(S,K)$ 对K非减

>数理证明见书69页。以 $c(S,K)$ 举例，从实际来理解，执行价格越高，发生的概率越小，为补偿风险因而价格越低或持平（非增）

定理5.3$\quad$ $c(S,K)$ 与 $p(S,K)$ 是K的凸函数

定理5.4$\quad$记 $\theta \geq 0$ 是由N只证券组成的组合，价格向量为 $S = [S_1;\cdots;S_N]>0$ 以及执行价格向量为 $K=[K_1;\cdots;K_N]>0$，有
$$
c(S^T \theta, K^T \theta) \leq \sum_{i=1}^N \theta_i c(S_i,K_i),\quad p(S^T \theta, K^T \theta) \leq \sum_{i=1}^N \theta_i p(S_i,K_i)
$$

> 以组合为标的的期权价值小于以组合中单个证券为标的资产的相应期权的组合的价值

定理5.5$\quad$ $S \geq c(S,K)$

> 看涨期权赋予的是“在未来以$K$价格购买一股股票的权利”。而直接持有一股股票则拥有该股票的全部，因此一份看涨期权的价格永远不能超过标的股票本身的价格


定理5.6$\quad$如果存在无风险证券，其收益率也就是利率为 $r_F$，那么 
$$c(S,K) \geq [S-\frac{K}{1+r_F}]_+$$

>看涨期权的价格，至少应该等于「当前股价」减去「执行价格的现值」

结合上面两个定理，得到欧式看涨期权价格的上界和下界：
$$
[S-\frac{K}{1+r_F}]_+ \leq c(S,K) \leq S
$$

定理5.7$\quad$看涨-看跌期权的平价关系：如果存在无风险证券且利率为 $r_F$，那么
$$
c(S,K) + \frac{K}{1+r_F} = p(S,K)+S
$$

> 等式左边:信托看涨策略 (Fiduciary Call),买入看涨期权并持有现金
> 等式右边：保护性看跌策略 (Protective Put)，买入股票并买入看跌期权
> 虽然这两个策略现在的构成完全不同，但在到期日（$T$ 时刻），无论股价是多少，它们手中的最终价值是完全一模一样的。根据一价定律（Law of One Price），如果两个东西未来的价值永远相等，那么它们现在的价格也必须相等。


### 美式期权以及提前执行

因为美式期权有权利提前执行，所以美式期权价格高于欧式期权：
$$
C(S,K) \geq c(S,K) ,\quad P(S,K) \geq p(S,K)
$$


无股利时，美式看涨期权将不会提前行权。因为提前行权得到的支付为 $S-K$，有:
$$
S-K \leq S - \frac{K}{1+r_F} \leq [S-\frac{K}{1+r_F}]_+ \leq c(S,K)
$$


>提前执行看涨期权所得到的价值不会高于把它看作欧式看涨期权卖出所得到的价值 $c(S,K)$
>原因：1.时间价值；2.在到期日不执行的权利


没有股利，提前执行美式看跌期权可能是最优的。如果提前执行期权，持有者现在就可以得到执行价格而不是在将来：
$$
P(S,K) = \max[K-S,p(S,K)] = \max[K-S,\frac{K}{1+r_F}-S+c(S,K)]
$$

如果 $K-S >\frac{K}{1+r_F}-S+c(S,K)$ 时，则提前执行美式看跌期权是最优的


现在假设股票在 $t=0$ 期还支付股利D，记S为发放股利后的股价
美式看涨期权的最优策略： $C(S,D,K)=\max[S+D-K,c(S,K)]$
美式看跌期权的最优策略： $P(S,D,K)=\max[K-S-D,p(S,K)]$

> S+D-K:提前行权，按执行价格K买入分红后价值为S+D的股票，得到差价S+D-K
> 股利的影响源于一个核心事实：股票支付股利后，股价会下跌（除息），但期权持有者拿不到股利
> 对于美式期权来说，股利促使持有者提前执行看涨期权（为了抢在除息前成为股东，拿到那笔现金分红）、推迟执行看跌期权（股利导致股价下跌，这对看跌期权是有利的。与其现在卖，不如等跌了再卖）



如果有股利，欧式看涨期权与看跌期权的平价关系：
$$
c(S,K)+\frac{K}{1+r_F}+D=S+p(S,K)
$$






### 完全市场中的期权定价

如果证券市场是完全的，那么存在唯一的状态价格向量 $\phi_\omega, \forall \omega \in \Omega$，记 $S_\omega$ 为标的资产在状态 $\omega$ 的支付，那么:
$$
c(S,K) = \sum_\omega \phi_\omega[S_\omega - K]_+ = \frac{E^Q[\tilde{S}-K]_+}{1+r_F}
$$

> 例子“股票的二叉树过程”见课本p75，此处简单介绍：
> 假设有 $p$ 的概率股票价格从 $S$ 上升至 $uS$，$1-p$ 的概率下降为 $dS$
> 再假设一个无风险证券利率是 $r_F$
> 无套利条件要求:$d<1+r_F<u$(证明略，反证法)
> 记股票的现价为 $S$，债券的价格 $B = \frac{1}{1+r_F}$
> 由资产定价基本原理知，存在状态价格向量 $\phi = [\phi_u;\phi_d] \gg 0$，使得：
> $S = \phi_u uS + \phi_d dS$
> $B=\phi_u + \phi_d$
> 期权的价格为：
> $c = \phi_u [uS-K]_+ + \phi_d[dS-K]_+$
> 直观上理解即期权现在的价格等于未来所有非负收益情况的加权和

欧式看涨期权到期日期权价值（支付）为:
$$ 
c_1=\left\{
\begin{matrix}
 c_u \equiv [uS-K]_+,S_1 = uS \\
 c_d \equiv [dS-K]_+,S_1 = dS \\
\end{matrix}
\right.
$$

> 相较于之前的公式，只是把股票的支付X替换为了现价S的表达S1 = X = dS或uS

考虑一个由股票和债券组成的组合: $\theta_S$ 份股票和 $\theta_B$ 份债券，在两种情况下的支付为:
$$
c_1=\left\{
\begin{matrix}
 v_u = \theta_s uS + \theta_B \\
 v_d = \theta_s dS + \theta_B \\
\end{matrix}
\right.
$$

选择 $\theta$ 使得 $v_u = c_u， v_d = c_d$，解如下：
$$
\theta_S = \frac{c_u-c_d}{(u-d)S},\theta_B = \frac{uc_d-dc_u}{(u-d)}
$$

> $v_u = c_u， v_d = c_d$ 使得在两种情况下收入（或支付）都满足消费

这个组合在0期的价值为 $v=\theta_S S + \frac{\theta_B}{1+r_F}$，无套利要求期权的价格 $c$ 等于 $v$，带入有:
$$
c = v = \frac{1}{1+r_F}[\frac{{1+r_F}-d}{u-d}c_u+\frac{u-(1+r_F)}{u-d}c_d]
$$

组合中股票的股数 $\theta_S$ 称为对冲比或期权的 $\delta$

给定状态价格，我们可以定义等价鞅测度：
$$
q = \frac{\phi_u}{\phi_u+\phi_d}=\frac{1+r_F-d}{u-d}\\
1-q = \frac{\phi_d}{\phi_u+\phi_d} = \frac{u-(1+r_F)}{u-d}
$$

> 即方程里面 $c_u$ 和 $c_d$ 的比例

并把期权定价公式重写为:
$$
c = \frac{1}{1+r_F} [qc_u + (1-q)c_d]=\frac{E^Q[c_1]}{1+r_F}
$$


定义 $\hat c \equiv \frac{c}{B}$ 和 $\hat S = \frac{S}{B}$，那么有
$$
\hat c_t = E_t^Q[\hat c_{t+1}],\hat S_t = E_t^Q[\hat S_{t+1}]
$$

故 $\hat c_t$ 和 $\hat S_t$ 在等价鞅测度Q下是鞅

根据股票和债券的价格为期权定价，这就是**二叉树期权定价模型**


### 期权与市场完全化


蝴蝶头寸：同一标的证券上的、到期日相同但执行价格不同的欧式看涨期权构成的组合

例：
1. 买入1份执行价格为 $K-\delta$ 的看涨期权
2. 卖出2份执行价格为 $K$ 的看涨期权
3. 买入1份执行价格为 $K+\delta$ 的看涨期权

在0期支付的价格为零，在1期的支付为:
$$
[S-(K-\delta)]_+ - 2[S-K]_+ + [S-(K+\delta)]_+ = \left\{
\begin{matrix}
    0,\quad S \leq K-\delta\\
    S-(S-\delta),\quad K-\delta < S < K\\
    -S+(S+\delta),\quad K < S < K+\delta\\
    0,\quad K+\delta < S
\end{matrix}
\right.
$$

![](./插图/图5.4.png)


引入衍生证券：假设存在一个证券（或组合），支付为 ${X_\omega,\omega \in \Omega}$

状态分离：$\forall \omega, \omega' \in \Omega$ 及 $\omega \neq \omega', X_\omega \neq X_{\omega'}$，该证券也叫状态指数证券

不失一般性，假设若 $\omega<\omega'$ 则 $X_\omega < X_{\omega'}$


执行价格为 $X_\omega$ 的欧式看涨期权有如下支付：
$$
[\tilde X - X_\omega]_+ = [0;\cdots;X_{\omega+1}-X_\omega;X_{\omega+2}-X_\omega;\cdots;X_\Omega-X_\omega]
$$

> 就是把之前证券的支付 $\tilde X$ 细分到每个情况的支付， $X_\omega$ 可以看作是认为情况 $\omega$ 会发生所以押注为执行价格


期权的引入有利于市场的完全化：
1. 买入1份状态指数证券
2. 买入状态指数证券的欧式看涨期权，执行价格分别为 $X_1,X_2,\cdots,X_{\Omega-1}$

可以看出在不同情况 $\omega$ 组成的支付矩阵是满秩的，即完全市场：
$$
X = \begin{bmatrix}
X_1 & 0 & 0 & \cdots & 0\\
X_2 & X_2-X_1 & 0 & \cdots & 0\\
X_3 & X_3-X_1 & X_3-X_2 & \cdots & 0\\
\vdots & \vdots & \vdots & \ddots & \vdots\\
X_\Omega & X_\Omega-X_1 & X_\Omega - X_2 & \cdots & X_\Omega-X_{\Omega-1}
\end{bmatrix}
$$

证明状态指数证券为标的的资产的期权组合可以复制状态或有证券（状态或有证券见第三章），证明见书p80，思路与上面类似



离散的Breeden-Litzenberger 结果：

记 $\phi_i$ 为状态 $\omega = i$ 的状态价格，那么
$$
\begin{matrix}
    \phi_i = \frac{1}{\delta} \{[c(K_{i-1})-c(K_i)]-[c(K_i)-c(K_{i+1})] \}\\
    =\frac{1}{\delta^2} \{[c(K_{i-1})-c(K_i)]-[c(K_i)-c(K_{i+1})] \}\delta
\end{matrix}
$$
> 分子：做多蝴蝶价差
> 为什么要除以 $\delta$（行权价间距）：蝴蝶价差最高支付 $\delta$ 元。为了把它变成标准的“状态价格”（最高支付 1 元，即 Arrow-Debreu 证券），我们需要把它的成本除以 $\delta$ 进行标准化。
> $\phi_i$ 就是Arrow-Debreu 证券的价格。它代表了：“现在的我，愿意花多少钱，来换取‘如果在未来股价刚好落在 $K_i$’时获得的 1 块钱”。
> 公式的第二行引入了平方项，这是为了通向连续时间的微积分：$$\phi_i = \underbrace{\frac{[c(K_{i-1})-2c(K_i)+c(K_{i+1})]}{\delta^2}}_{\approx \frac{\partial^2 c}{\partial K^2}} \times \delta$$
> 中括号里的部分除以 $\delta^2$，在数学上是二阶差分，当 $\delta \to 0$ 时，它就是看涨期权价格对行权价的二阶导数 $\frac{\partial^2 c}{\partial K^2}$。
> Breeden-Litzenberger 定理告诉我们：看涨期权价格对执行价格的二阶导数，等于风险中性下的概率密度函数 (PDF)。
> 所以这个公式的物理含义是：$$\text{状态价格} \approx (\text{概率密度}) \times (\text{区间宽度} \delta )$$





其中 $K=i\delta$，任意支付为 ${X_\omega}$ 的资产，其价格应该为
$$
S = \sum_i \frac{[c(K_{i-1})-c(K_i)]-[c(K_i)-c(K_{i+1})]}{\delta^2}X_{\omega_i}\delta
$$
> 写成更直观的形式：$$S = \sum_i \phi_i \cdot X_{\omega_i}$$
> 
> 这是金融学中最根本的无套利定价原理：任何资产现在的价格 $S$，等于它在未来所有可能状态下的回报 $X_{\omega_i}$，乘以该状态对应的状态价格 $\phi_i$，然后求和。




由于 $\omega_i$ 与 $K_i$ 一一对应，因此也可以用 $K_i$ 来描述状态，证券的支付可以表示为 $K$ 的函数，记 $X(K)$ 。当指数证券是连续分布的时候，K可取大于0的任意实数，并且 $c(·)$二阶可导时，取 $\delta = dK$，有
$$
\frac{1}{\delta^2} \{[c(K_{i-1})-c(K_i)]-[c(K_i)-c(K_{i+1})] \} = \frac{\partial^2 c(K)}{\partial K^2} \vert _{K=K_i} 
$$

> 当我们把行权价的间隔 $\delta$ 变得无穷小（$\delta \to 0$）时，数学上“二阶差分除以 $\delta^2$”的极限，就是函数的二阶导数。

于是可以将证券定价的离散形式转化为连续形式：
$$
S = \int_{o}^{\infty} \frac{\partial^2 c(K)}{\partial K^2} X(K)dK
$$


> 离散形式：$S = \sum \phi_i X_i$ （价格 = $\sum$ 状态价格 $\times$ 支付）
> 连续形式：求和号 $\sum$ 变成了积分号 $\int$, $\delta$ 变成了 $dK$。
> 离散状态价格 $\phi_i$ 变成了状态价格密度（State Price Density），即 $\frac{\partial^2 c(K)}{\partial K^2}$。支付 $X_i$ 变成了函数 $X(K)$。
> 理解：这就像是用无数个极微小的“蝴蝶价差”拼凑出了整个资产。每一小段 $dK$ 的“状态价格”就是 $\frac{\partial^2 c}{\partial K^2} dK$，乘以该状态下的支付 $X(K)$，加总起来就是资产现在的价值。

我们可以用密度函数来定义风险中性:
$$
q(K) = \frac{\partial^2 c(K)}{\partial K^2} / \int_{o}^{\infty} \frac{\partial^2 c(K)}{\partial K^2}dK
$$


无风险债券的价格是：
$$
B = \int_{0}^{\infty} \frac{\partial^2 c(K)}{\partial K^2} dK
$$

> 定义：无风险债券（Zero-coupon bond）的特点是：无论未来发生什么，我都支付 1 元。
> 代入公式：令支付函数 $X(K) = 1$（恒等于1）。

因此
$$
\frac{S}{B} = \int_{0}^{\infty} q(K)X(K) dK
$$

> 写成更常见的形式：$$S = B \times \underbrace{\int_{0}^{\infty} q(K)X(K) dK}_{E^Q[X(K)]}$$
> 右边积分的含义：概率 $q(K)$ 乘以支付 $X(K)$ 的积分，在统计学上就是期望值（Expectation）。
> 整体含义：资产现在的价格 $S$ = (无风险折现因子 $B$) $\times$ (未来支付在风险中性概率下的期望值 $E^Q[X]$)。



## 第6章 期望效用函数

### 期望效用函数

期望效用函数：不同消费路径效用的期望值：
$$
U(c)=\sum_{\omega \in \Omega} \pi_\omega u_\omega (c_0,c_{1\omega})
$$

公理4$\quad$独立性公理：假设消费计划$c$与$c'$相对于某一状态有相同的消费路径$x$且$c \gtrsim c'$，那么如果我们把$x$换成另一个消费路径$y$，$c$与$c'$的排序不变

> 无论什么情景$\omega$，消费者都更喜欢$c$


定理6.1$\quad$Debreu：在独立性公理的假设下，定理2.1给出的效用函数具有$U(c)=\sum_{\omega \in \Omega} \pi_\omega u_\omega (c_0,c_{1\omega})$式的期望效用形式

> 定理2.1$\quad$（Debreu）对于一个在闭的、凸消费集C上由定义2.3所定义的、满足公理2的偏好，存在以一个定义于C上的连续效用函数U(·)使得$\forall a,b \in C, a \succsim b, 当且仅当U(a) \ge U(b)$


### 附加假设

1. 状态独立的期望效用函数：
$$
U(c)=\sum_{\omega \in \Omega} p_\omega u_\omega (c_0,c_{1\omega})
$$

2. 时间可加性：
$$
u(c_0,c_1) = u_0 (c_0) + u_1(c_1)
$$

则有
$$
U(c)=u_0(c_0)+\sum_{\omega \in \Omega} p_\omega u_1 (c_{1\omega})
$$

进一步简化，将$u_1$看作是$u_0$乘一个正系数$\rho$（也叫时间偏好系数，小于1代表在时间上缺乏耐心）：
$$
u_0(c_0)+u_1(c_1)=u(c_0)+\rho u(c_1),\rho >0
$$

那么
$$
U(c)=u_0(c_0)+\rho \sum_{\omega \in \Omega} u(c_{1\omega})
$$

注：U具有序数性，而u具有基数性


### 期望效用函数的拓展

（不重要，此处略）

---


## 第7章 风险厌恶

### 边际效用递减

定义7.1$\quad$对于函数$u(·)$，如果 $\forall x, y, \alpha \in [0,1], u(\alpha x + (1-\alpha)y) \geq \alpha u(x) + (1-\alpha)u(y)$ ，我们称 $u(·)$ 是凹函数

定理7.1$\quad$如果凸的连续偏好由 $U(c)=u_0(c_0)+\rho \sum_{\omega \in \Omega} u(c_{1\omega})$ 表示，那么相应的效用函数$u(·)$是凹的

定理7.2$\quad$如果凹函数是二阶可微的，那么$u''\leq 0$

> 即凹凸函数的二阶导判断法



### 风险厌恶的定义

#### 绝对风险厌恶

定义7.2$\quad$记 $\tilde g$ 为一个不确定支付，若 $E[\tilde g]=0$ ，则称 $\tilde g$ 为一个公平赌博

定义7.3$\quad$若 $E[u(\omega+\tilde{g})] \leq (<) E[u(\omega)],\forall E[\tilde{g}]=0$，则称效用函数为$u(·)$的参与者是严格风险厌恶的

> 严格风险厌恶者总是不希望有随机性/风险出现的


定理7.3$\quad$当且仅当$u$是（严格）凹函数时，参与者是（严格）风险厌恶的



### 风险厌恶的度量

用风险溢价来衡量风险厌恶的参与者偏好于确定性支付而非不确定性支付的偏好强度

定义7.4$\quad$一个参与者参与一个公平赌博所要求的风险溢价$\pi$，定义为 $E[u(\omega+\tilde{g})] = u(\omega - \pi)$

> 风险溢价是参与者为了消除风险而愿意放弃的财富值
> 风险赌博的确定性等值：$-\pi$

本定义不是定义风险溢价的唯一方法，比如我们也可以定义成参与者因承担风险而要求的最小财富值：
$$
E[u(\omega+\tilde{g}+\hat{\pi})] = u(\omega)
$$

对于相同风险而言，$\hat{\pi}$和$\pi$不一定相同

一般来说，风险溢价取决于风险本身，也就是赌博$\tilde{g}$的性质

定义7.5$\quad$当随机变量$\tilde{g}$取值范围很小时，称$\tilde{g}$为小风险的赌博

Arrow-Pratt 绝对风险厌恶度量：

对$E[u(\omega+\tilde{g})] = u(\omega - \pi)$泰勒展开：
$$
E[u(\omega + \tilde g)] = u(\omega)+\frac{1}{2} u''(\omega)E[\tilde{g}^2]+o(\tilde{g}^2)\\
=u(\omega)-u'(\omega)\pi +o(\pi^2)
$$

其中$b(z^m)$代表$z^m$的高阶无穷小量，因此小风险的风险溢价为 $\pi = \frac{1}{2} [- \frac{u''(\omega)}{u'(\omega)}]Var[\tilde g]$

> 第一步：左边的展开（风险预期效用）
> 我们要计算持有风险资产时的预期效用 $E[u(\omega + \tilde g)]$。
> 由于 $\tilde{g}$ 是一个小风险（趋近于0），我们可以在 $\omega$ 处进行二阶泰勒展开：
> $$ 
> u(\omega + \tilde g) \approx u(\omega) + u'(\omega)\tilde{g} + \frac{1}{2}u''(\omega)\tilde{g}^2
> $$
> 两边同时取期望 $E[\cdot]$：
> $$
> E[u(\omega + \tilde g)] \approx E[u(\omega)] + E[u'(\omega)\tilde{g}] + E[\frac{1}{2}u''(\omega)\tilde{g}^2]
> $$
> 由于 $\omega$ 是常数，$u'(\omega)$ 也是常数，提取出来：
> $$
> E[u(\omega + \tilde g)] \approx u(\omega) + u'(\omega)\underbrace{E[\tilde{g}]}_{0} + \frac{1}{2}u''(\omega)\underbrace{E[\tilde{g}^2]}_{\sigma^2}
> $$
> 因为假设是公平赌局，$E[\tilde{g}]=0$，中间项消失。得到推导中的第一个等式：
> $$
> \text{左边} = u(\omega) + \frac{1}{2}u''(\omega)\sigma^2
>$$
> 第二步：右边的展开（确定性等价）
> 右边 $u(\omega - \pi)$ 代表的是，为了避免风险，我愿意把财富从 $\omega$ 减少到 $\omega - \pi$（确定性等价财富）。
> 由于 $\pi$ 是一个很小的风险溢价，我们在 $\omega$ 处进行**一阶泰勒展开**（为什么不用二阶？见下文解释）：
> $$
> u(\omega - \pi) \approx u(\omega) + u'(\omega)(-\pi)
> $$
> 得到推导中的第二个等式：
> $$
> \text{右边} = u(\omega) - u'(\omega)\pi
> $$
> **关键数学细节**：为什么右边只展到一阶（$\pi$），而左边展到二阶（$\tilde{g}^2$）？
> 因为 $\pi$ 与 $\sigma^2$ 是同数量级的（$\pi \sim O(\sigma^2)$）。如果我们右边也展到二阶，会出现 $\pi^2$，也就是 $O(\sigma^4)$，这是极高阶的无穷小，可以直接忽略。为了让等式两边保持数量级一致（都是二阶小量），左边需要 $\tilde{g}^2$，右边只需要 $\pi$。
> 第三步：左右相等求解，得到$\pi = \frac{1}{2} [- \frac{u''(\omega)}{u'(\omega)}]Var[\tilde g]$

记风险厌恶的度量为$A(\omega) = - \frac{u''(\omega)}{u'(\omega)}$，也称为绝对风险厌恶，依赖效用函数$u$和财富情况$\omega$

绝对风险厌恶的倒数称为风险容忍系数：
$$
T(\omega) \equiv \frac{1}{A(\omega)} = - \frac{u'(\omega)}{u''(\omega)}
$$




#### 相对风险厌恶


考虑总财富作为基数的赌博和风险溢价：
$$
E[u(\omega (1+\tilde g))] = u(\omega(1-\pi_R))
$$

则有：
$$
\pi_R = \frac{1}{2} [- \frac{\omega u''(\omega)}{u'(\omega)}]Var[\tilde g]
$$

相对风险厌恶 $R(\omega) \equiv - \frac{\omega u''(\omega)}{u'(\omega)}$








### 风险厌恶的几个例子


1. 线性或风险中性效用函数：$u(\omega) = \omega$
$A(\omega) = R(\omega) = 0$

2. 负指数效用函数: $u(\omega)=-\exp{-\alpha \omega},\alpha > 0$
$A(\omega) = \alpha, R(\omega) = \alpha \omega$
负指数效用函数具有常数绝对风险厌恶CARA

3. 平方效用函数：$u(\omega) = \omega - \frac{1}{2}\alpha \omega^2, \alpha > 0, \omega \in [0,\frac{1}{\alpha})$
$A(\omega) = \frac{\alpha}{1-\alpha\omega}, R(\omega)=\frac{\alpha\omega}{1-\alpha\omega}$

4. 幂指数效用函数:$u(\omega)=\frac{1}{1-\gamma}\omega^{1-\gamma},\gamma > 0, \gamma \ne 1$
$A(\omega) = \frac{\gamma}{\omega},R(\omega) = \gamma$
常数相对风险厌恶CRRA

5. 对数效用函数:$u(\omega) = \log \omega$
$A(\omega) = \frac{1}{\omega}, R(\omega) = 1$

6. 双曲线绝对风险厌恶(HARA):
$A(\omega) = \frac{1}{d+\omega /\ \gamma},\gamma \geq -1$

绝对风险厌恶递增（递减）：给定某个偏好，绝对风险厌恶随财富的增加（减少）而增加（减少）

相对风险厌恶递增（递减）：给定某个偏好，相对风险厌恶随财富的增加（减少）而增加（减少）

### 风险厌恶的比较

记$u_1(\omega),u_2(\omega)$是两个递增的、二阶可微的效用函数，$A_1(\omega),A_2(\omega)$是他们相应的绝对风险厌恶系数

定理7.4$\quad$Pratt：下面的命题是等价的

1. $A_1(\omega) \geq A_2(\omega),\forall \omega$
>在任何财富水平$\omega$下，投资者1的效用函数比投资者2弯曲得更厉害。
2. $u_1(u_2^{-1}(z))$是凹的
> 命题3的几何表述
3. $\exist f(·), f'(·)>0, f''(·) \leq 0$,使得$u_1(\omega) = f[u_2(\omega)]$
> $u_1$是在$u_2$的基础上，再经过一个凹函数f的弯曲
4. $\pi_1 \geq \pi_2$，对所有的$\omega$和公平赌博成立
> 更厌恶风险的人（1号），愿意支付更高的“保费”（$\pi_1$）来消除风险。



### 一阶风险厌恶

若$u(·)$是不可微的，则前面的讨论需要修正

考虑效用函数：
$$
u(\omega) = \left\{
\begin{matrix}
    a_+ (\omega - \bar\omega),\omega \geq \bar\omega\\
    a_- (\omega - \bar\omega),\omega < \bar\omega
\end{matrix}
\quad a_{-} > a_{+} > 0
\right.
$$

拿伯努利赌博举例：输赢概率相等，都是$\delta$，其风险溢价为$\pi = \frac{1}{2} (a_{-}-a_{+})\delta$，这个博弈的方差是$\delta^2$，$\delta$很小时其风险溢价与风险厌恶比可微的情况要高一阶，因此也称一阶风险厌恶


---

## 第八章 组合选择（一）

记秩为N的交易证券支付矩阵为X，记相应价格为S，则每一参与者的优化问题是
$$
\max_\theta \quad u_0(c_0) + \sum_{\omega = 1}^{\Omega} \pi_\omega u_1(c_{1\omega})\\
s.t. \quad c_0 = e_0 - S^T\theta\\
\quad c_1 = e_1 + X\theta
c_0,c_1 \geq 0
$$

### 解的存在性及其特征

定理8.1$\quad$当且仅当证券市场，记作{X,S}，不存在套利机会时，上式有解

把预算约束代入效用函数（且忽略消费非负约束），有：
$$
\max_\theta u_0(e_0 - S^T\theta) + \sum_{\omega \in \Omega}\pi_\omega u_1(e_{1\omega}+X_\omega \theta) \\
$$

一阶条件(Euler方程)：
$$
u_0'(c_0)S_n = \sum_{\omega \in \Omega}\pi_\omega u_1'(c_\omega)X_{\omega,n} = E[u_1'(\tilde c_1) \tilde{X_n}]
$$

即$E[\frac{u_1'(\tilde c_1)}{u_0'(c_0)} \frac{\tilde X_n}{S_n}] = 1$，投资对当下消费的相对边际效用全都等于1



### 投资组合的选择

记组合$\theta$的价值为$\omega \equiv e_0 - c_0 = S^T\theta$

问题变成求两个最优：1. 求解给定储蓄$\omega$下最优组合；2. 求解最优储蓄

给定投资总额，第一个求解的方程为
$$
v_1(\omega) = \max_{ \{ \theta:S^T\theta =\omega \} } E[u_1(\tilde e_1 + \tilde X \theta)]
$$

其中$\tilde X$是N只交易证券的随机支付向量，$v_1(\omega)$是财富$\omega$的间接效用函数，即用$\omega$进行最优投资所获得的期望效用

> 为简化问题，后续假定$\tilde e_1 = 0$，问题化为 
> $$
> v(\omega) \equiv \max_{ \{ \theta:S^T\theta =\omega \} } E[u(\tilde X\theta)]
> $$ 


最优化的组合问题为：
$$
\max_{\omega} \{ u_0(e_0-\omega) + \max_{ \{ \theta:S^T\theta =\omega \} } E[u_1(\tilde e_1 + \tilde X \theta)] \} \\
=\max_{\omega} u_0(e_0-\omega) + v_1(\omega)
$$

下面令第N只证券为无风险证券，利率为$r_F$，记$a_n = \theta_n S_n$为证券n上的投资额，那么证券n的总收益率为$\tilde x_n \equiv \frac{\tilde{X}_n}{S_n}$，净收益率为$\tilde{r_n} = \frac{\tilde{X}_n}{S_n} - 1$

那么
$$
\tilde{\omega} = \sum_{n=1}^N \theta_n \tilde{X}_n  = \sum_{n = 1}^N a_n \tilde{x}_n = \sum_{n=1}^N a_n(1+\tilde{r}_n) = \omega (1+r_F)+\sum_{n=1}^{N-1}a_n(\tilde r _n - r_F)
$$

其中$\omega = \sum_{n=1}^N a_n$，$a$代表在这些证券上的投资额

> $\omega (1+r_F)$就是把无风险利率提取出来

最优组合选择问题变成：
$$
\max_a E[u(\tilde \omega)] = E[u(\omega(1+r_F)+\sum_{n=1}^{N-1}a_n(\tilde r _n - r_F))]\\
=E[u(\omega(1+r_F)+a^T(\tilde r - r_F \iota))]
$$

这里$\iota$是元素全为1的列向量

前面的一阶条件变为$E[u'(\tilde \omega)(\tilde r _i - r _F)]$

### 最优组合的性质

#### 单只风险证券


定理8.2$\quad$如果参与者都是严格风险厌恶的，那么
·$a=0$，当且仅当$E[\tilde r] = r_F$
·$a>0$，当且仅当$E[\tilde r] > r_F$
·$a<0$，当且仅当$E[\tilde r] < r_F$

风险溢价:$E[\tilde{r}] - r_F$

令$A(\omega)$为参与者的绝对风险厌恶，$\omega$为他的总投资额，假设$E[\tilde r]>r_F$，那么根据定理8.2我们有a>0。令
$$
a(\omega) = \argmax E[u(\omega(1+r_F)+a(\tilde r - r_F))]
$$

定理8.3$\quad$我们有：
·$a'(\omega)=0$，当且仅当$A'(\omega) = 0$(CARA)
·$a'(\omega)>0$，当且仅当$A'(\omega) < 0$(DARA)
·$a'(\omega)<0$，当且仅当$A'(\omega) > 0$(IARA)

可以用a对财富的弹性来刻画风险资产的相对投资倾向：
$$
e(\omega) \equiv \frac{\omega}{a} \frac{da}{d\omega}
$$

定理8.4$\quad$我们有：
·$e = 1$，当且仅当$R'(\omega) = 0$(CARA)
·$e > 1$，当且仅当$R'(\omega) < 0$(DARA)
·$e < 1$，当且仅当$R'(\omega) > 0$(IARA)

#### 多只风险证券

定理8.5$\quad$当且仅当$E[\tilde{r}_n] = r_F, \forall n = 1,\cdots,N-1$时考虑最优组合$a = 0$

定理8.6$\quad$最优组合的期望收益率大于无风险收益率

---


## 第九章 组合选择（二）
<!-- 
### 随机占优

定义9.1$\quad$如果$\forall u'(·) \geq 0: E[u(\tilde{x}_A)] \geq E[u(\tilde{x}_B)]$，则称A相对于B为一阶随机占优，记作$A \succeq _{FSD} B$

记$\tilde{r}_A$和$\tilde{r}_B$分别为证券A、B的净收益率，$\tilde{x}_A = 1+ \tilde{r}_A$和$\tilde{x}_B = 1+ \tilde{r}_B$是总收益率

记$F_A(x)$和$F_B(x)$分别为$\tilde{x}_A$和$\tilde{x}_B$的累积分布函数

定理9.1$\quad$下列叙述等价：
1. $A \succeq _{FSD} B$
2. $F_A(x) \leq F_B(x), \forall x$
3. $\tilde{r}_A \sim _{d} \tilde{r}_B +\tilde{a}, \tilde{a} \geq 0 $
注：$\sim _{d}$表示分布相同

定理9.2$\quad$如果$A \succsim _{FSD} B$且$E[\tilde{r}_B] \geq r_F$，那么对于$u'(·)>0$以及$u''(·)<0$有
$$
\max_a E[u(\omega(1+r_F))+a(\tilde{r}_A-r_F)]
\geq \max_a E[u(\omega(1+r_F))+a(\tilde{r}_B-r_F)]
$$

一阶随机占优反映的是收益率（特别是期望收益率）的占优

定义9.2$\quad$如果$\forall u''(·) \leq 0: E[u(\tilde{x}_A)] \geq E[u(\tilde{x}_B)] $，则称A相对于B的二阶随机占优，记作A \succeq _{SSD} B$

二阶占优是相对于两个期望相等的收益率而言，比较两只证券或者组合的风险


定理9.1$\quad$下列叙述等价：
1. $A \succeq _{SSD} B$
2. $E[\tilde{x}_A] = E[\tilde{x}_B],\int_0^y [F_A(x) - F_B(x)]dx \equiv S(y) \leq 0, \forall y$
3. $\tilde{r}_B \sim _{d} \tilde{r}_A +\tilde{e}, \tilde{e} = 0 $
注：$\sim _{d}$表示分布相同

定义9.3$\quad$如果每个可能状态下证券A的收益率总是高于证券B的收益率，则称A占优于B


### 组合分离
 -->






## 随机占优 (Stochastic Dominance)

传统的均值-方差分析依赖于特定的效用函数（如二次型）或正态分布假设。随机占优提供了一种更通用的方法，允许我们在只知道投资者偏好的一般特征（如“喜欢更多财富”或“厌恶风险”）而不知道具体函数形式时，对风险资产进行排序。

### 一阶随机占优 (First-order Stochastic Dominance, FSD)

**核心逻辑**：只要投资者**喜欢更多财富**（非满足性，$u' \ge 0$），A就优于B。

*   **定义 9.1**：
    若对于所有满足 $u'(x) \ge 0$ 的效用函数 $u$，都有 $E[u(\tilde{x}_A)] \ge E[u(\tilde{x}_B)]$，则称资产 A 相对于 B 为一阶随机占优，记作 $A \succeq_{FSD} B$。

*   **定理 9.1（等价条件）**：
    以下叙述等价：
    1.  $A \succeq_{FSD} B$
    2.  $F_A(x) \le F_B(x), \forall x$ （A的累积分布函数始终位于B的下方或重合）
    3.  $\tilde{r}_A \sim_d \tilde{r}_B + \tilde{a}$，其中 $\tilde{a} \ge 0$ （A的收益率分布等同于B加上一个非负随机变量）

*   **直观理解**：对于任意回报水平 $x$，A 获得大于 $x$ 回报的概率总是高于或等于 B。

### 二阶随机占优 (Second-order Stochastic Dominance, SSD)

**核心逻辑**：投资者不仅喜欢更多财富，而且**厌恶风险**（$u' \ge 0$ 且 $u'' \le 0$）。在期望收益相同时，风险更小的优于风险大的。

*   **定义 9.2**：
    若对于所有满足 $u'(\cdot) \ge 0$ 且 $u''(\cdot) \le 0$ 的效用函数，都有 $E[u(\tilde{x}_A)] \ge E[u(\tilde{x}_B)]$，则称 A 相对于 B 为二阶随机占优，记作 $A \succeq_{SSD} B$。

*   **定理 9.3（等价条件）**：
    以下叙述等价：
    1.  $A \succeq_{SSD} B$
    2.  $E[\tilde{x}_A] = E[\tilde{x}_B]$ 且 $\int_0^y [F_A(x) - F_B(x)] dx \le 0, \forall y$
    3.  $\tilde{x}_B \sim_d \tilde{x}_A + \tilde{e}$，且 $E[\tilde{e} | x_A] = 0$

*   **均值保持展布 (Mean Preserving Spread)**：条件3说明，B 可以看作是 A 加上了一个“噪音”（$\tilde{e}$），这增加了风险但没有增加期望收益。

### 状态占优 vs. 随机占优

*   **状态占优 (State Dominance)**：指在每一个可能的状态下，A 的收益都大于等于 B（且至少有一个状态严格大于）。
    *   $x_A(\omega) \ge x_B(\omega), \forall \omega \in \Omega$。
    *   **套利机会**：若 A 状态占优于 B 且价格相同，则存在无风险套利机会。
*   **区别**：随机占优只看概率分布，不看具体状态。随机占优并不意味着一定存在套利机会，因为两个资产可能在不同状态下表现不同。

---

## 共同基金分离 (Mutual Fund Separation)

在构建最优投资组合时，如果所有投资者的最优选择都可以由少数几个“基准基金”的线性组合构成，这就叫基金分离。这极大地简化了投资决策。

### 定义与概念

*   **$F$-基金分离**：若所有投资者的最优组合 $z$ 都位于 $R^N$ 空间中的一个 $F$ 维线性子空间中，即：
    $$ z_k = \sum_{i=1}^F \lambda_i z_{f_i} $$
    其中 $z_{f_i}$ 是分离基金（基准基金）。
*   **两基金货币分离 (Two-fund Monetary Separation)**：
    *   基金 1：无风险资产。
    *   基金 2：风险资产组合（即市场组合）。
    *   这是资本资产定价模型 (CAPM) 的基础。

### 基金分离成立的条件

基金分离的成立依赖于**收益率分布的性质**或**投资者效用函数的性质**。

#### A. 基于收益率分布的限制 (Ross, 定理 9.4)

如果收益率分布满足特定的线性因子结构，即便投资者效用函数各异（只要是递增凹函数），两基金分离也成立。

**条件**：
1.  **线性生成过程**：风险资产收益率由一个共同因子 $\tilde{y}$ 和特质因子 $\tilde{e}_n$ 决定：
    $$ \tilde{x}_n = x_F + \beta_n \tilde{y} + \tilde{e}_n $$
2.  **条件期望为零**：$E[\tilde{e}_n | \tilde{y}] = 0$。
3.  **大数定律/充分分散**：市场组合中，特质风险被完全分散消除，$\sum w_n \tilde{e}_n = 0$。

**含义**：因为特质风险可以通过组合消除，投资者只需要持有无风险资产和共同因子组合（系统性风险）。

#### B. 基于效用函数的限制 (Cass-Stiglitz)

如果不对收益率分布做限制，要求所有投资者都有相同的最优风险组合，则对效用函数有极强的限制。

*   **定理 9.6**：当且仅当所有投资者具有**二次效用函数**时，两基金分离成立。
*   **定理 9.7 (Cass-Stiglitz)**：若要求两基金货币分离对任意分布都成立，当且仅当投资者的边际效用满足 HARA (Hyperbolic Absolute Risk Aversion) 形式，且风险厌恶系数的参数相关：
    $$ u'(w) = (d + \frac{w}{\gamma})^{-\gamma} $$
    其中，这就包括了我们熟悉的CRRA（常相对风险厌恶）和CARA（常绝对风险厌恶）效用函数作为特例。

---


## 第10章 完全市场中的资源配置与资产价格 

### 什么是完全市场？

完全市场：**当交易证券的支付矩阵 $X$ 的秩等于未来可能的状态数 $N$ 时，市场就是完全的。**

*   **通俗理解**：这意味着针对未来发生的任何一种“状态”（比如下雨、晴天、经济繁荣、经济萧条），你都能找到一种特定的证券组合，刚好在那一种状态下支付1块钱，而在其他状态下支付0。这种组合被称为**阿罗证券（Arrow-Debreu Security）**。
*   **经济学含义**：由于可以通过组合现有证券来复制任何可能的未来现金流，因此在这个市场中没有“无法对冲的风险”。



### 完全市场中的均衡

#### 状态价格 (State Prices)
在完全市场中，我们可以求出一组**状态价格向量 $\phi \gg 0$**。
*   $\phi_\omega$ 表示：为了在未来状态 $\omega$ 获得1单位的支付，你现在需要支付的价格。
*   **定价公式**：任意资产 $y$ 的当前价格 $S$ 等于其未来支付现值的加总：
    $$ S = \phi^T y = \sum_{\omega \in \Omega} \phi_\omega y_\omega $$

#### 个体的优化问题
参与者 $k$ 的目标是在预算约束下最大化期望效用：
$$ \max \quad u_{k,0}(c_{k,0}) + \sum_{\omega} p_{\omega} u_{k,1}(c_{k,1\omega}) $$
$$ \text{s.t.} \quad c_{k,0} + \sum_{\omega} \phi_\omega c_{k,1\omega} = w_k $$
其中 $w_k$ 是该参与者的初始财富（禀赋的现值）。

#### 均衡条件
通过拉格朗日乘数法，我们得到一阶条件：
$$ \frac{p_{\omega} u'_{k,1}(c_{k,1\omega})}{u'_{k,0}(c_{k,0})} = \phi_\omega $$

这告诉我们一个重要的经济直觉：
> **不同状态下消费的边际效用之比（经概率调整后）等于它们的状态价格之比。**

**状态价格密度:**
我们将 $\frac{\phi_\omega}{p_\omega}$ 称为状态价格密度。
*   **定理 10.2**：在一个特定的状态 $\omega$ 下，如果状态价格密度 $\frac{\phi_\omega}{p_\omega}$ 较低（即该状态下的保险很便宜），那么该状态下的消费 $c_{k,1\omega}$ 就会较高。反之亦然。



#### 最优配置与风险分担

既然市场是完全的，市场的资源配置效率如何？

##### 帕累托最优
*   **福利经济学第一定理**：完全市场的竞争均衡配置是帕累托最优的。
*   **中央计划者问题**：我们可以把市场均衡想象成一个“中央计划者”在最大化所有参与者效用的加权和：
    $$ \max \sum_k \mu_k U_k $$
    其中 $\mu_k$ 是与个体的初始财富有关的权重。

##### 风险分担原则 (Risk Sharing)
这是本章最精彩的结论之一。在完全市场中，个体的消费 $c_{k,1\omega}$ 与他个人的禀赋风险无关，只取决于**总消费（Aggregate Consumption）** $C_{1\omega}$。

*   **定理 10.6 (单调性)**：如果总消费 $C_{1\omega}$ 在某个状态下较高，那么所有人的消费在该状态下也都较高。
*   **直觉**：大家都在一条船上。完全市场消除了**个体风险 (Idiosyncratic Risk)**，只剩下了**总体风险 (Aggregate Risk)**。个人的运气好坏不重要，重要的是整个经济体的蛋糕有多大。



### 线性分担规则与代表性参与者

#### 线性分担规则
在什么情况下，大家的消费不仅同涨同跌，而且是线性关系？
*   **条件**：当所有参与者具有相同指数 $\gamma$ 的 HARA (Hyperbolic Absolute Risk Aversion) 效用函数时。
*   **结果**：$c_{k,1\omega} = a_k + b_k C_{1\omega}$。即你的消费是总消费的线性函数。

#### 代表性参与者 (Representative Agent)
由于所有人的消费都由总消费决定，我们可以构造一个虚拟的“代表性参与者”。
*   这个代表性参与者的禀赋就是经济中的**总禀赋**。
*   他的效用函数是所有个体效用的加权和。
*   **意义**：资产定价变得非常简单。我们不需要去问每一个投资者的偏好，只需要研究这个“代表性参与者”的偏好和总消费的波动，就能决定市场价格。


### 基于消费的资本资产定价模型 (CCAPM) 

这是现代资产定价的基石。

#### 定价模型核心公式
利用代表性参与者的边际效用，我们可以得到资产 $n$ 的价格 $S_n$：
$$ S_n = E[\tilde{\pi} \tilde{X}_n] $$
其中 $\tilde{\pi}$ 是**随机折现因子 (Stochastic Discount Factor, SDF)**，定义为：
$$ \tilde{\pi} = \frac{u'_1(\tilde{C}_1)}{u'_0(C_0)} $$
也就是未来边际效用与当前边际效用之比（边际替代率）。

#### 风险溢价的经济学解释
将上述公式展开，我们可以看到资产价格与风险的关系：
$$ S_n = \frac{E[\tilde{X}_n]}{1+r_F} + \text{Cov}[\tilde{\pi}, \tilde{X}_n] $$
*   **第一项**：风险中性定价（未来期望现金流折现）。
*   **第二项**：**风险调整项**。
    *   如果资产支付 $\tilde{X}_n$ 与 $\tilde{\pi}$ 负相关（即与总消费 $\tilde{C}_1$ 正相关），这意味着在你“有钱”（总消费高，边际效用低）的时候它给钱，在你“没钱”的时候它不给钱。**这属于“锦上添花”的资产，风险大，价格低，预期回报高。**
    *   相反，如果资产在你“没钱”时给钱（是一种保险），价格就会高（包含溢价），预期回报低。

#### 利率与宏观经济 (实利率理论)
无风险利率 $r_F$ 取决于两点：
1.  **时间偏好**：如果你不耐烦（$\rho$ 小），利率要高才能吸引你储蓄。
2.  **消费增长**：如果预期未来大家更有钱（$\bar{g}$ 高），现在的钱更值钱，利率会高。

近似公式：
$$ r_F \approx \left(\frac{1}{\rho} - 1\right) + \frac{R}{\rho}\bar{g} $$
其中 $R$ 是相对风险厌恶系数，$\bar{g}$ 是消费增长率。



### 从 CCAPM 到 CAPM

CCAPM 理论很完美，但实际数据很难测（消费数据频率低、误差大）。我们可以把它简化为我们熟知的 CAPM。

*   **桥梁**：如果我们将**市场组合 (Market Portfolio)** 的收益率作为总消费增长的代理变量。
*   **推导**：通过泰勒展开和线性回归系数的定义，CCAPM 可以转化为：
    $$ \bar{r}_n - r_F \approx \beta_{n,m} (\bar{r}_m - r_F) $$
    这正是我们熟悉的资本资产定价模型（CAPM）。
*   **结论**：CAPM 本质上是 CCAPM 的一个特例或近似。贝塔 ($\beta$) 衡量的是资产收益与市场总风险（总消费波动）的相关性。




你好！我是这一门金融经济学课程的主讲教授。

今天我们进入**第11章：不完全市场中的资源配置和资产定价 (Resource Allocation and Asset Pricing in Incomplete Markets)**。

在之前的课程中，我们通常假设市场是完全的（Complete Markets），即对于每一种可能的状态，都存在对应的Arrow-Debreu证券。然而在现实世界中，交易成本、信息不对称等摩擦导致**资产数量往往远少于未来的状态数量**。

本章我们将探讨在这种**市场不完全**的设定下，资产如何定价，以及资源配置的效率如何。

---

## 第11章 不完全市场中的资源配置和资产定价

### 11.1 消费和证券价格 (Consumption and Asset Prices)

#### 1. 市场结构设定
*   **状态空间**：$\Omega$ 个可能的状态。
*   **资产数量**：$N$ 个线性独立的资产。
*   **不完全市场定义**：当 $N < \Omega$ 时，资产支付矩阵 $X$ 不能张成整个 $\mathbb{R}^\Omega$ 空间。
*   **支付空间 (Marketable Space, $M$)**：
    $$ M = \{ X\theta : \theta \in \mathbb{R}^N \} $$
    $M$ 是 $\mathbb{R}^\Omega$ 的一个 $N$ 维线性子空间。

#### 2. 消费者的优化问题
消费者的消费不再是任意的，必须落在预算约束允许的子空间内。

*   **预算约束**：
    $$ c_{k,1} = e_{k,1} + X\theta_k $$
    这意味着消费偏离禀赋的部分 $c_{k,1} - e_{k,1}$ 必须属于市场空间 $M$。

*   **优化目标**：
    $$ \max_{\theta} \quad u_{k,0}(c_{k,0}) + \mathbb{E}[u_{k,1}(\tilde{c}_{k,1})] $$
    $$ \text{s.t.} \quad c_{k,0} = e_{k,0} - S^\top \theta_k $$
    $$ \quad \quad \tilde{c}_{k,1} = \tilde{e}_{k,1} + \tilde{X} \theta_k $$

#### 3. 一阶条件与定价公式推导
我们将约束代入目标函数求导（关于持仓量 $\theta$）：

$$ \frac{\partial}{\partial \theta}: \quad -u'_{k,0}(c_{k,0}) S + \mathbb{E}[u'_{k,1}(\tilde{c}_{k,1}) \tilde{X}] = 0 $$

整理得到**欧拉方程 (Euler Equation)**：
$$ S = \mathbb{E} \left[ \frac{u'_{k,1}(\tilde{c}_{k,1})}{u'_{k,0}(c_{k,0})} \tilde{X} \right] $$

定义**个体 $k$ 的随机折现因子 (SDF)** 或 **边际替代率 (MRS)** 为 $\pi_k$：
$$ \pi_k = \frac{u'_{k,1}(\tilde{c}_{k,1})}{u'_{k,0}(c_{k,0})} $$

则对任意资产 $n$，定价公式为：
$$ S_n = \mathbb{E}[\pi_k \tilde{X}_n], \quad \forall k $$

#### 4. 状态价格密度的非唯一性
这是不完全市场与完全市场的**核心区别**：
*   **完全市场**：$\pi_k$ 对所有投资者是一致的（即唯一的 $\phi$）。
*   **不完全市场**：由于市场不能完全对冲风险，不同投资者面临的未定权益消费可能不同，因此他们的边际效用比率 $\pi_k$ 不同。
*   **无套利条件**：虽然 $\pi_k$ 因人而异，但根据无套利资产定价基本定理，只要不存在套利机会，就存在**至少一个**正的状态价格向量 $\phi \gg 0$ 使得 $S = \phi^\top X$。
    *   在不完全市场中，这样的状态价格向量 $\phi$ 有**无穷多个**。
    *   所有 $\phi$ 在子空间 $M$ 上的投影是相同的（定价已知资产），但在与 $M$ 正交的方向上可以任意变化。



### 11.2 约束下的最优配置 (Constrained Optimal Allocation)

在完全市场中，均衡配置是帕累托最优（Pareto Optimal）的。但在不完全市场中，我们无法达到全局帕累托最优。我们需要引入一个新的效率概念。

#### 1. 两个定义
*   **定义 11.1 (可获得配置 Attainable)**：
    配置 $\{c_k\}$ 是可获得的，如果对于每个参与者，其净交易都在市场空间内：
    $$ c_{k,1} - e_{k,1} \in M, \quad \forall k $$
    且市场出清 $\sum c_k = \sum e_k$。

*   **定义 11.2 (约束最优 Constrained Optimal)**：
    如果在所有**可获得（Attainable）**的配置中，找不到另一个配置 $\{c'_k\}$ 使得所有人的效用不降低且至少有一人效用提高，则称该配置为**约束最优**。

#### 2. 定理 11.1：不完全市场的福利经济学第一定理
> **定理**：在证券市场结构 $X$ 下的竞争性均衡配置是**约束最优**的。

**证明思路（反证法）：**
1.  假设均衡配置不是约束最优，即存在另一个可获得的配置 $\{c'_k\}$ 帕累托优于均衡配置。
2.  由消费者优化的性质，帕累托改进意味着新配置在当前价格体系下更贵：
    $$ \sum_k \phi^\top (c'_{k,1} - e_{k,1}) > \sum_k \phi^\top (c_{k,1} - e_{k,1}) $$
3.  利用市场出清条件 $\sum (c'_{k,1} - e_{k,1}) = 0$ 和 $\sum (c_{k,1} - e_{k,1}) = 0$。
4.  上式两边均为0，产生矛盾 $0 > 0$。
5.  **结论**：均衡必须是约束最优的。

**注意**：这并不意味着政府干预无效。如果政府能改变资产结构 $M$（引入新资产），可能会改善福利。但在给定 $M$ 的情况下，市场已经做到了最好。



### 11.3 实质完全市场 (Effectively Complete Markets)

虽然 $N < \Omega$，但在某些特殊情况下，不完全市场依然可以达到**全局帕累托最优**。这种情况我们称之为**实质完全 (Effectively Complete)**。

#### 1. 定义与条件
*   **定义 11.3**：如果通过证券市场 $X$ 可以获得所有的帕累托最优配置，称市场是**实质完全**的。
*   **定理 11.2**：如果市场是实质完全的，那么均衡配置就是帕累托最优的。

我们主要关注两种实现实质完全的特殊情形：

#### 情形 A：以总禀赋为标的的期权 (Options on Aggregate Endowment)
*   **逻辑**：帕累托最优配置通常只依赖于**总消费（市场组合）**的水平，而非每个具体状态的特异性风险。
*   **定理 11.3**：如果市场包含**以市场组合（总禀赋）为标的的、执行价格齐备的期权**，那么市场是实质完全的。
    *   设总禀赋 $X_M$ 有 $N_d$ 个不同的取值。
    *   如果存在 $N_d$ 个基于 $X_M$ 的线性独立资产（如看涨期权），即使 $N_d \ll \Omega$（总状态数），市场对于分配总风险而言也是完全的。

#### 情形 B：HARA 效用函数 (HARA Utility Functions)
*   **设定**：所有投资者具有相同参数 $\gamma$ 的线性风险容忍度（HARA）效用函数：
    $$ u'_k(c) = (d_k + c/\gamma)^{-\gamma} $$
    且存在无风险资产。
*   **定理 11.4**：在此设定下，市场是实质完全的。
*   **证明逻辑**：
    1.  根据 Wilson (1968) 定理，当所有代理人拥有同指数 HARA 效用时，帕累托最优配置 $c_{k,1}$ 是总禀赋 $X_M$ 的**线性函数**。
    2.  线性函数形式为：$c_{k,1} = a_k + b_k X_M$。
    3.  这种配置可以通过持有**无风险资产**（提供 $a_k$）和**市场组合股票**（提供 $b_k X_M$）来复制。
    4.  只要市场包含这两类资产，哪怕没有其他衍生品，也能实现帕累托最优。

---
